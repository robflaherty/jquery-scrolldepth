/*!
 * jquery.scrolldepth.js | v0.1.2
 * Copyright (c) 2012 Rob Flaherty (@robflaherty)
 * Licensed under the MIT and GPL licenses.
 */
;(function($,window,document,undefined){"use strict";var defaults={elements:[],minHeight:0,offset:0,percentage:true,testing:false,eventHandler:null},$window=$(window),cache=[];$.scrollDepth=function(options){var startTime=+new Date;options=$.extend({},defaults,options);if($(document).height()<options.minHeight){return}sendEvent('Percentage','Baseline');function googleAnalyticsHandler(action,label,timing){_gaq.push(['_trackEvent','Scroll Depth',action,label,1,true]);if(arguments.length>2){_gaq.push(['_trackTiming','Scroll Depth',action,timing,label,100])}}function sendEvent(action,label,timing){if(!options.testing){if(options.eventHandler){options.eventHandler(action,label,timing)}else{googleAnalyticsHandler(action,label,timing)}}else{$('#console').html(action+': '+label)}}function calculateMarks(docHeight){return{'25%':parseInt(docHeight*0.25,10),'50%':parseInt(docHeight*0.50,10),'75%':parseInt(docHeight*0.75,10),'100%':docHeight-1}}function checkMarks(marks,scrollDistance,timing){$.each(marks,function(key,val){if($.inArray(key,cache)===-1&&scrollDistance>=val){sendEvent('Percentage',key,timing);cache.push(key)}})}function checkElements(elements,scrollDistance,timing){var label;$.each(elements,function(index,elem){if($.inArray(elem,cache)===-1&&$(elem).length){if(scrollDistance>=$(elem).offset().top){label=(typeof elem.id=="undefined")?elem.localName:elem.id;sendEvent('Elements',label,timing);cache.push(elem)}}})}$window.on('scroll.scrollDepth',function(){var docHeight=$(document).height(),winHeight=window.innerHeight?window.innerHeight:$window.height(),scrollDistance=$window.scrollTop()+winHeight,offset=parseInt(winHeight*(options.offset/100),10),marks=calculateMarks(docHeight),timing=+new Date-startTime;var elements=expand(options.elements);if(cache.length>=4+elements.length){$window.off('scroll.scrollDepth');return}if(options.elements){checkElements(elements,scrollDistance,timing)}if(options.percentage){checkMarks(marks,scrollDistance,timing)}});function expand(element_selectors){var elements=[];$.each(element_selectors,function(i,selector){$.merge(elements,$(selector))})return elements}}})(jQuery,window,document);